{% extends "base.html" %}

{% block title %}Manager Reports{% endblock %}

{% block content %}
<div class="p-6">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">
            <i class="fas fa-chart-bar text-blue-600 mr-3"></i>
            Manager Reports
        </h1>
        <p class="text-gray-600 mt-2">Full data lists for customers and vehicles</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

        <!-- 🧍 Customer List -->
        <div class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow">
            <div class="px-6 py-4 border-b flex justify-between items-center">
                <h2 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-users mr-3 text-green-600"></i>
                    Customer List
                </h2>
                <a href="{{ url_for('bp.export_customers_csv') }}"
                   class="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700">
                    <i class="fas fa-download mr-2"></i>Download CSV
                </a>
            </div>

            <div class="max-h-96 overflow-y-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Phone</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for customer in customers %}
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3 text-sm font-medium text-gray-900">{{ customer.CustomerID }}</td>
                            <td class="px-4 py-3 text-sm text-gray-700">{{ customer.Name }}</td>
                            <td class="px-4 py-3 text-sm text-gray-700">{{ customer.Phone or 'N/A' }}</td>
                            <td class="px-4 py-3 text-sm text-gray-700">{{ customer.Email or 'N/A' }}</td>
                            <td class="px-4 py-3 text-sm space-x-2">
                                <!-- Edit Button -->
                                <button type="button"
                                        onclick="openEditCustomerModal({{ customer.CustomerID }})"
                                        class="px-3 py-1 text-xs font-medium text-white bg-blue-500 rounded hover:bg-blue-600">
                                    <i class="fas fa-edit mr-1"></i>Edit
                                </button>

                                <!-- Delete Button -->
                                <form action="{{ url_for('bp.delete_customer_route') }}" method="POST" class="inline">
                                    <input type="hidden" name="customer_id" value="{{ customer.CustomerID }}">
                                    <button type="submit"
                                            onclick="return confirm('Are you sure you want to delete this customer? This is permanent.')"
                                            class="px-3 py-1 text-xs font-medium text-white bg-red-500 rounded hover:bg-red-600">
                                        <i class="fas fa-trash mr-1"></i>Delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" class="px-4 py-4 text-center text-gray-500">No customers found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 🚗 Vehicle List -->
        <div class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow">
            <div class="px-6 py-4 border-b flex justify-between items-center">
                <h2 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-car mr-3 text-blue-600"></i>
                    Vehicle List
                </h2>
                <a href="{{ url_for('bp.export_vehicles_csv') }}"
                   class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">
                    <i class="fas fa-download mr-2"></i>Download CSV
                </a>
            </div>

            <div class="max-h-96 overflow-y-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">License Plate</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Make/Model</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Owner</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for vehicle in vehicles %}
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3 text-sm font-medium text-gray-900 font-mono">{{ vehicle.LicensePlate }}</td>
                            <td class="px-4 py-3 text-sm text-gray-700">
                                {{ vehicle.Make or 'N/A' }} {{ vehicle.Model or '' }}
                            </td>
                            <td class="px-4 py-3 text-sm text-gray-700">
                                {{ vehicle.CustomerName }} (ID: {{ vehicle.CustomerID }})
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="3" class="px-4 py-4 text-center text-gray-500">No vehicles found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<!-- Optional: Edit Customer Modal -->
<div id="editCustomerModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6">
        <h3 class="text-lg font-semibold mb-4">Edit Customer</h3>
        <form id="editCustomerForm" method="POST" action="{{ url_for('bp.update_customer_route') }}">
            <input type="hidden" name="customer_id" id="editCustomerID">
            <div class="mb-3">
                <label for="editCustomerName" class="block text-sm font-medium text-gray-700">Name</label>
                <input type="text" name="name" id="editCustomerName" class="w-full border rounded px-3 py-2 mt-1" required>
            </div>
            <div class="mb-3">
                <label for="editCustomerPhone" class="block text-sm font-medium text-gray-700">Phone</label>
                <input type="text" name="phone" id="editCustomerPhone" class="w-full border rounded px-3 py-2 mt-1">
            </div>
            <div class="mb-3">
                <label for="editCustomerEmail" class="block text-sm font-medium text-gray-700">Email</label>
                <input type="email" name="email" id="editCustomerEmail" class="w-full border rounded px-3 py-2 mt-1">
            </div>
            <div class="flex justify-end space-x-2 mt-4">
                <button type="button" onclick="closeEditCustomerModal()" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">
                    Cancel
                </button>
                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    Save Changes
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal JS -->
<script>
function openEditCustomerModal(id) {
    const modal = document.getElementById('editCustomerModal');
    modal.classList.remove('hidden');
    document.getElementById('editCustomerID').value = id;
}

function closeEditCustomerModal() {
    const modal = document.getElementById('editCustomerModal');
    modal.classList.add('hidden');
}
</script>
{% endblock %}
